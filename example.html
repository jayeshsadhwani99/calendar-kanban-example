<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Tap and Hold Drag POC</title>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      /* Styling the box */
      #box {
        width: 100px;
        height: 100px;
        background-color: blue;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        user-select: none; /* Prevent text selection */
        -webkit-user-select: none; /* For Safari */
        touch-action: none; /* Disable default touch gestures */
        position: absolute;
        top: 100px;
        left: 100px;
      }
    </style>
  </head>
  <body>
    <div id="box">hello</div>
    <script>
      const box = document.getElementById("box");
      let dragging = false;
      let holdTimer = null;
      let offsetX = 0;
      let offsetY = 0;
      let startX = 0;
      let startY = 0;
      const holdDuration = 2000; // 2 seconds
      const moveThreshold = 10; // Pixel distance to cancel the hold if moved

      // When the touch starts on the box
      box.addEventListener("touchstart", function (event) {
        event.preventDefault();
        if (event.touches.length !== 1) return; // Only support single-touch
        const touch = event.touches[0];
        startX = touch.clientX;
        startY = touch.clientY;
        // Start a timer; if the user holds for 2 seconds without moving too far, enable dragging.
        holdTimer = setTimeout(function () {
          dragging = true;
          // Calculate the offset between the touch and the box's top-left corner
          const boxRect = box.getBoundingClientRect();
          offsetX = startX - boxRect.left;
          offsetY = startY - boxRect.top;
        }, holdDuration);
      });

      // Listen for movements anywhere on the document.
      document.addEventListener(
        "touchmove",
        function (event) {
          event.preventDefault();
          if (event.touches.length !== 1) return;
          const touch = event.touches[0];

          if (!dragging) {
            // If the user moves too much before the hold timer finishes, cancel the hold.
            if (
              Math.abs(touch.clientX - startX) > moveThreshold ||
              Math.abs(touch.clientY - startY) > moveThreshold
            ) {
              clearTimeout(holdTimer);
            }
          }

          if (dragging) {
            // Update the box's position so it follows the touch location, adjusting for the initial offset.
            const newX = touch.clientX - offsetX;
            const newY = touch.clientY - offsetY;
            box.style.left = newX + "px";
            box.style.top = newY + "px";
          }
        },
        { passive: false },
      );

      // Clear state on touch end or cancellation.
      document.addEventListener("touchend", function (event) {
        event.preventDefault();
        clearTimeout(holdTimer);
        dragging = false;
      });

      document.addEventListener("touchcancel", function (event) {
        event.preventDefault();
        clearTimeout(holdTimer);
        dragging = false;
      });
    </script>
  </body>
</html>
